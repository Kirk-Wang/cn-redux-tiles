
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>读我，了解我是干啥的～ · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="introduction/README.md" />
    
    
    <link rel="prev" href="./" />
    

    <style>
    @media only screen and (max-width: 640px) {
        .book-header .hidden-mobile {
            display: none;
        }
    }
    </style>
    <script>
        window["gitbook-plugin-github-buttons"] = {"repo":"Kirk-Wang/cn-redux-tiles","types":["star","fork","watch"],"size":"large"};
    </script>

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2" data-path="original_readme.html">
            
                <a href="original_readme.html">
            
                    
                    读我，了解我是干啥的～
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="introduction/README.md">
            
                <span>
            
                    
                    介绍
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="introduction/Motivation.md">
            
                <span>
            
                    
                    动机
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="introduction/Boilerplate.md">
            
                <span>
            
                    
                    Redux样板代码概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="introduction/Comparison.md">
            
                <span>
            
                    
                    与其他解决方案比较
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="introduction/Example.md">
            
                <span>
            
                    
                    实例
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="api/README.md">
            
                <span>
            
                    
                    API
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="api/createTile.md">
            
                <span>
            
                    
                    createTile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="api/createSyncTile.md">
            
                <span>
            
                    
                    createSyncTile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="api/createMiddleware.md">
            
                <span>
            
                    
                    createMiddleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="api/createActions.md">
            
                <span>
            
                    
                    createActions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="api/createReducers.md">
            
                <span>
            
                    
                    createReducers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="api/createSelectors.md">
            
                <span>
            
                    
                    createSelectors
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="api/createEntities.md">
            
                <span>
            
                    
                    createEntities
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="advanced/README.md">
            
                <span>
            
                    
                    高级话题
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="advanced/integration.md">
            
                <span>
            
                    
                    与现有项目整合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="advanced/nesting.md">
            
                <span>
            
                    
                    嵌套
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="advanced/selectors.md">
            
                <span>
            
                    
                    选择器
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="examples/README.md">
            
                <span>
            
                    
                    实例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="examples/calculator.md">
            
                <span>
            
                    
                    计算器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="examples/hacker-news-api.md">
            
                <span>
            
                    
                    HackerNews API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >读我，了解我是干啥的～</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="redux-tiles">Redux-Tiles</h1>
<p><a href="https://travis-ci.org/Bloomca/redux-tiles" target="_blank"><img src="https://travis-ci.org/Bloomca/redux-tiles.svg?branch=master" alt="Build Status"></a>
<a href="https://badge.fury.io/js/redux-tiles" target="_blank"><img src="https://badge.fury.io/js/redux-tiles.svg" alt="npm version"></a>
<a href="https://coveralls.io/github/Bloomca/redux-tiles?branch=master" target="_blank"><img src="https://coveralls.io/repos/github/Bloomca/redux-tiles/badge.svg?branch=master" alt="Coverage Status"></a>
<a href="https://david-dm.org/bloomca/redux-tiles" target="_blank"><img src="https://david-dm.org/bloomca/redux-tiles/status.svg" alt="dependencies Status"></a></p>
<p><strong><a href="https://redux-tiles.js.org/" target="_blank">&#x82F1;&#x6587;&#x6587;&#x6863;</a></strong></p>
<p>Redux&#x662F;&#x4E00;&#x4E2A;&#x975E;&#x5E38;&#x597D;&#x7684;&#x5E93;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x53D8;&#x5F97;&#x6E05;&#x6670;&#x3002;&#x4F46;&#x95EE;&#x9898;&#x5728;&#x4E8E;&#x5B83;&#x7684;&#x6837;&#x677F;&#x4EE3;&#x7801;&#x5199;&#x7684;&#x592A;&#x5197;&#x957F;&#x4E86;&#xFF0C;&#x800C;&#x4E14;&#x4F60;&#x7ECF;&#x5E38;&#x4F1A;&#x89C9;&#x5F97;&#x4F60;&#x4E00;&#x6B21;&#x53C8;&#x4E00;&#x6B21;&#x5730;&#x505A;&#x540C;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#x3002; &#x8FD9;&#x4E2A;&#x5E93;&#x8BD5;&#x56FE;&#x5728;Redux&#x4E4B;&#x4E0A;&#x63D0;&#x4F9B;&#x6700;&#x5C0F;&#x7684;&#x62BD;&#x8C61;&#xFF0C;&#x4EE5;&#x5141;&#x8BB8;&#x8F7B;&#x677E;&#x7684;&#x7EC4;&#x5408;&#x3001;&#x5BB9;&#x6613;&#x7684;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x548C;&#x5065;&#x5168;&#x7684;&#x53EF;&#x6D4B;&#x8BD5;&#x6027;&#x3002;&#x53EF;&#x4EE5;&#x5728;<a href="https://bloomca.github.io/redux-tiles/advanced/integration.html" target="_blank">&#x73B0;&#x6709;&#x9879;&#x76EE;&#x4E2D;</a>&#x5F00;&#x59CB;&#x4F7F;&#x7528;&#x6B64;&#x5E93;, &#x5E76;&#x9010;&#x6B65;&#x6DFB;&#x52A0;&#x65B0;&#x529F;&#x80FD;&#x3002;</p>
<blockquote>
<p><strong><a href="http://blog.bloomca.me/2017/06/02/why-i-created-redux-tiles-library.html" target="_blank">&#x66F4;&#x591A;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x5E93;&#x80CC;&#x540E;&#x7684;&#x57FA;&#x672C;&#x539F;&#x7406;</a></strong><br></p>
<p><strong><a href="examples">&#x5B9E;&#x4F8B;</a></strong></p>
<ul>
<li><a href="examples/calculator">Calculator</a></li>
<li><a href="examples/todomvc">TodoMVC</a></li>
<li><a href="examples/hacker-news-api">Hacker News API</a></li>
<li><a href="examples/github-api">Github API</a></li>
</ul>
</blockquote>
<h2 id="&#x5B89;&#x88C5;">&#x5B89;&#x88C5;</h2>
<p>&#x8981;&#x5B89;&#x88C5;&#x6700;&#x65B0;&#x7684;&#x7A33;&#x5B9A;&#x7248;&#x672C;&#xFF0C;&#x8BF7;&#x8FD0;&#x884C;&#xFF1A;</p>
<pre><code class="lang-shell">npm install --save redux-tiles
</code></pre>
<p>&#x8FD9;&#x4E2A;&#x8F6F;&#x4EF6;&#x5305;&#x662F;&#x57FA;&#x4E8E;&#x6211;&#x5FC3;&#x4E2D;&#x7684;&#x8FD9;&#x4E2A;&#x60F3;&#x6CD5;&#x6784;&#x5EFA;&#x7684;&#xFF0C;&#x4EBA;&#x4EEC;&#x901A;&#x5E38;&#x4F1A;&#x4F7F;&#x7528;&#x4E00;&#x4E9B;&#x6253;&#x5305;&#x5DE5;&#x5177; - <a href="https://webpack.js.org/" target="_blank">Webpack</a>, <a href="http://browserify.org/" target="_blank">Browserify</a> or <a href="http://rollupjs.org/" target="_blank">Rollup</a>&#x3002; &#x8BE5;&#x5305;&#x672C;&#x8EAB;&#x662F;&#x7528;TypeScript&#x7F16;&#x5199;&#x7684;&#xFF0C;&#x5E76;&#x4E14;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x63D0;&#x4F9B;&#x7ACB;&#x5373;&#x53EF;&#x7528;&#x7684;typings&#x3002;</p>
<p>&#x5982;&#x679C;&#x7531;&#x4E8E;&#x67D0;&#x79CD;&#x539F;&#x56E0;&#x4E0D;&#x4F7F;&#x7528;bundler&#xFF0C;&#x5219;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4F4D;&#x4E8E;<a href="https://unpkg.com/redux-tiles@0.6.1/dist/" target="_blank">dist&#x6587;&#x4EF6;&#x5939;</a>&#x4E2D;&#x7684;UMD&#x7248;&#x672C;&#x3002; &#x53EA;&#x9700;&#x5728;&#x4F60;&#x7684;&#x9875;&#x9762;&#x4E2D;&#x901A;&#x8FC7;<code>script</code>&#x6807;&#x7B7E;&#x5305;&#x542B;&#x5B83;&#xFF0C;&#x7136;&#x540E;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x5728;window.ReduxTiles&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4E0B;&#x5F97;&#x5230;&#x5B83;&#x3002;</p>
<h2 id="toc">TOC:</h2>
<ul>
<li><a href="#user-content-example-of-use">&#x4F7F;&#x7528;&#x793A;&#x4F8B;</a></li>
<li><a href="#user-content-rationale">&#x57FA;&#x672C;&#x539F;&#x7406;</a></li>
<li><a href="#user-content-integration-api">&#x96C6;&#x6210;API</a></li>
<li><a href="#user-content-tiles-api">Tiles API</a></li>
<li><a href="#user-content-nesting">&#x5D4C;&#x5957;</a></li>
<li><a href="#user-content-middleware">&#x4E2D;&#x95F4;&#x4EF6;</a></li>
<li><a href="#user-content-server-side-rendering">&#x670D;&#x52A1;&#x7AEF;&#x6E32;&#x67D3;</a></li>
<li><a href="#user-content-selectors">&#x9009;&#x62E9;&#x5668;</a></li>
<li><a href="#user-content-tests">&#x6D4B;&#x8BD5;</a></li>
</ul>
<h2 id="&#x4F7F;&#x7528;&#x793A;&#x4F8B;">&#x4F7F;&#x7528;&#x793A;&#x4F8B;</h2>
<blockquote>
<p><a href="https://redux-tiles.js.org/introduction/Example.html" target="_blank">&#x66F4;&#x5168;&#x9762;&#x7684;&#x4F8B;&#x5B50;</a></p>
</blockquote>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { createTile, createSyncTile } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;redux-tiles&apos;</span>;

<span class="hljs-comment">// &#x540C;&#x6B65;tile&#x5B58;&#x50A8;&#x4FE1;&#x606F;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5F02;&#x6B65;&#x7684;&#x4E1C;&#x897F;</span>
<span class="hljs-keyword">const</span> loginStatus = createSyncTile({
  type: [<span class="hljs-string">&apos;user&apos;</span>, <span class="hljs-string">&apos;loginStatus&apos;</span>],
  fn: ({ params: status }) =&gt; ({
    status,
    timestamp: <span class="hljs-built_in">Date</span>.now(),
  }),
});

<span class="hljs-comment">// &#x8BF7;&#x6C42;&#x5230;&#x670D;&#x52A1;&#x5668;</span>
<span class="hljs-comment">// &#x5B83;&#x662F;&#x7EDD;&#x5BF9;&#x5206;&#x5F00;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5F88;&#x5BB9;&#x6613;</span>
<span class="hljs-comment">// &#x7EC4;&#x5408;&#x4E0D;&#x540C;&#x7684;&#x8BF7;&#x6C42;</span>
<span class="hljs-keyword">const</span> authRequest = createTile({
  type: [<span class="hljs-string">&apos;user&apos;</span>, <span class="hljs-string">&apos;authRequest&apos;</span>],
  <span class="hljs-comment">// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;dispatch, actions, selectors, &#x7B49; -</span>
  <span class="hljs-comment">// &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x521B;&#x5EFA;&#x4E2D;&#x95F4;&#x4EF6;&#x65F6;&#x4F20;&#x9012;&#x6240;&#x9700;&#x7684;&#x6240;&#x6709;&#x5185;&#x5BB9;</span>
  <span class="hljs-comment">// &#x5B83;&#x4F7F;&#x6211;&#x4EEC;&#x80FD;&#x591F;&#x66F4;&#x5BB9;&#x6613;&#x5730;&#x8FDB;&#x884C;&#x6D4B;&#x8BD5;&#xFF0C;&#x5E76;&#x4E14;&#x4E5F;&#x53EF;&#x4EE5;&#x7EC4;&#x6210;&#x5176;&#x4ED6;&#x7684;tiles</span>
  fn: ({ params, api, dispatch, actions, getState }) =&gt;
    api.post(<span class="hljs-string">&apos;/login&apos;</span>, params),
});

<span class="hljs-comment">// &#x5B9E;&#x9645;&#x7684;&#x4E1A;&#x52A1;&#x903B;&#x8F91;</span>
<span class="hljs-comment">// &#x8BF7;&#x6CE8;&#x610F;&#xFF0C;&#x6211;&#x4EEC;&#x4E0D;&#x5728;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x76F4;&#x63A5;&#x7684;`api`&#x8C03;&#x7528;</span>
<span class="hljs-comment">// &#x6211;&#x4EEC;&#x53EA;&#x662F;&#x7EC4;&#x6210;&#x5176;&#x4ED6;&#x57FA;&#x672C;&#x7684;tiles</span>
<span class="hljs-keyword">const</span> authUser = createTile({
  type: [<span class="hljs-string">&apos;user&apos;</span>, <span class="hljs-string">&apos;auth&apos;</span>],
  fn: <span class="hljs-keyword">async</span> ({ params, dispatch, actions, selectors, getState }) =&gt; {
    <span class="hljs-comment">// &#x767B;&#x5F55;&#x7528;&#x6237;</span>
    <span class="hljs-keyword">const</span> { data: { id }, error } = <span class="hljs-keyword">await</span> dispatch(actions.tiles.user.authRequest(params));

    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(error);
    }

    <span class="hljs-comment">// &#x540C;&#x6B65;&#x5730;&#x8BBE;&#x7F6E;&#x7528;&#x6237;&#x72B6;&#x6001;</span>
    dispatch(actions.tiles.user.loginStatus(<span class="hljs-literal">true</span>));

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },
});
</code></pre>
<h2 id="&#x57FA;&#x672C;&#x539F;&#x7406;">&#x57FA;&#x672C;&#x539F;&#x7406;</h2>
<p>&#x6709;&#x8DB3;&#x591F;&#x7684;&#x9879;&#x76EE;&#x6765;&#x4FDD;&#x6301;&#x60A8;&#x7684;&#x72B6;&#x6001;&#x7BA1;&#x7406;&#x6E05;&#x6670;(<a href="https://github.com/erikras/ducks-modular-redux" target="_blank">&#x4F8B;&#x5982;</a>)&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x4E3B;&#x8981;&#x662F;&#x5173;&#x4E8E;&#x7EC4;&#x7EC7;&#x7684;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x4ECE;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x90A3;&#x91CC;&#x5220;&#x9664;&#x91CD;&#x590D;&#x5185;&#x5BB9;&#x7684;&#x9EBB;&#x70E6;&#x3002;&#x5176;&#x4ED6;&#x8F6F;&#x4EF6;&#x5305;&#x4E3A;&#x60A8;&#x63D0;&#x4F9B;&#x4E86;&#x4E0E;REST-API&#x7684;&#x5168;&#x9762;&#x96C6;&#x6210;&#xFF0C;<a href="https://github.com/paularmstrong/normalizr" target="_blank">&#x89C4;&#x8303;</a>&#x4F60;&#x7684;&#x5B9E;&#x4F53;&#xFF0C;&#x5EFA;&#x7ACB;&#x6A21;&#x578B;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x7B49;&#x7B49;&#x3002;&#x8FD9;&#x91CC;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F; &#x2013; &#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x9700;&#x8981;&#x7C7B;&#x4F3C;&#x8FD9;&#x6837;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x5E76;&#x4E14;&#x6709;&#x80FD;&#x529B;&#x67E5;&#x8BE2;&#x4F60;&#x7684;&#x672C;&#x5730;&#x201C;&#x6570;&#x636E;&#x5E93;&#x201D;&#xFF0C;&#x6211;&#x5F3A;&#x70C8;&#x5EFA;&#x8BAE;&#x4F60;&#x521B;&#x5EFA;&#x4F60;&#x81EA;&#x5DF1;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x5B83;&#x5C06;&#x6839;&#x636E;&#x4F60;&#x7684;&#x5177;&#x4F53;&#x95EE;&#x9898;&#x5B9A;&#x5236;&#x3002;</p>
<p>&#x8FD9;&#x4E2A;&#x8F6F;&#x4EF6;&#x5305;&#x4E13;&#x6CE8;&#x4E8E;&#x975E;&#x5E38;&#x57FA;&#x672C;&#x7684;&#x6A21;&#x5757;&#xFF0C;&#x8FD9;&#x5BF9;&#x4E8E;&#x975E;&#x5E38;&#x7B80;&#x5355;&#x7684;&#x5E94;&#x7528;&#x6765;&#x8BF4;&#x662F;&#x5F88;&#x597D;&#x7684;(e.g. login/logout, fetch client data, set up calculator values).</p>
<h2 id="&#x96C6;&#x6210;api">&#x96C6;&#x6210;API</h2>
<p>&#x5C3D;&#x7BA1;&#x4F7F;&#x7528;&#x6613;&#x4E8E;&#x4F7F;&#x7528;&#x7684;&#x8F6F;&#x4EF6;&#x5305;&#x7F16;&#x5199;&#x65B0;&#x6A21;&#x5757;&#xFF0C;&#x4F46;&#x60A8;&#x8FD8;&#x662F;&#x5FC5;&#x987B;&#x505A;&#x4E00;&#x4E9B;&#x5DE5;&#x4F5C;&#x624D;&#x80FD;&#x5C06;&#x5176;&#x96C6;&#x6210;&#x5230;&#x60A8;&#x7684;&#x9879;&#x76EE;&#x4E2D;&#x3002; &#x7B80;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x4F60;&#x5FC5;&#x987B;&#x6709;&#x4E00;&#x4E2A;&#x4E2D;&#x95F4;&#x4EF6;&#x6765;&#x5904;&#x7406;&#x6D3E;&#x9063;&#x52A8;&#x4F5C;&#x7684;&#x8FD4;&#x56DE;&#x51FD;&#x6570;&#xFF08;&#x5728;&#x8FD9;&#x4E2A;&#x5305;&#x4E2D;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#xFF0C;&#x5E76;&#x4E14;<a href="https://github.com/gaearon/redux-thunk" target="_blank">redux-thunk</a>&#x4E5F;&#x53EF;&#x4EE5;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x4F60;&#x5FC5;&#x987B;&#x7ED3;&#x5408;&#x6240;&#x6709;&#x7684;&#x6A21;&#x5757;&#x6765;&#x521B;&#x5EFA;actions&#x548C;reducers&#x3002; &#x5728;&#x8FD9;&#x4E2A;&#x5C0F;&#x4F8B;&#x5B50;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF1A;</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { createTile, createEntities, createMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;redux-tiles&apos;</span>;
<span class="hljs-keyword">import</span> { createStore, applyMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;redux&apos;</span>;

<span class="hljs-keyword">const</span> clientDataTile = createTile({
  type: [<span class="hljs-string">&apos;client&apos;</span>, <span class="hljs-string">&apos;data&apos;</span>],
  fn: ({ api, params}) =&gt; api.get(<span class="hljs-string">&apos;/client/info&apos;</span>),
});

<span class="hljs-keyword">const</span> tiles = [
  clientDataTile,
];

<span class="hljs-keyword">const</span> { actions, reducer, selectors } = createEntities(tiles);

<span class="hljs-comment">// we inject `actions` and `selectors` into middleware, so they</span>
<span class="hljs-comment">// will be available inside `fn` function of all tiles</span>
<span class="hljs-keyword">const</span> { middleware } = createMiddleware({ actions, selectors });

createStore(reducer, applyMiddleware(middleware));
</code></pre>
<h2 id="tiles-api">Tiles API</h2>
<p>Tiles are the heart of this library. They are intended to be very easy to use, compose and to test.
There are two types of tiles &#x2013; asynchronous and synchronous. Modern applications are very dynamic, so async ones will be likely used more often. Also, don&apos;t constrain yourself into the mindset that async tiles are only for API communication &#x2013; it might be anything, which involves some asynchronous interaction (as well as composing other tiles) &#x2013; for instance, long polling implementation.</p>
<blockquote>
<p><a href="https://redux-tiles.js.org/api/createTile.html" target="_blank">Full documentation for async tiles</a>
```javascript
import { createTile } from &apos;redux-tiles&apos;;</p>
</blockquote>
<p>const photos = createTile({
  // they will be structured api.photos inside redux state,
  // and also available under actions and selectors as:
  // actions.tiles.api.photos
  type: [&apos;api&apos;, &apos;photos&apos;],</p>
<p>  // params is an object with which we dispatch the action
  // you can pass only one parameter, so keep it as an object
  // with different properties
  //
  // all other properties are from your middleware
  // fn expects promise out of this function
  fn: ({ params, api }) =&gt; api.get(&apos;/photos&apos;, params),</p>
<p>  // to nest data:
  // { 5:
  //    10: {
  //      isPending: true,
  //      fetched: false,
  //      data: null,
  //      error: null,
  //   },
  // },
  // if you save under the same nesting array, data will be replaced
  // other branches will be merged
  nesting: (params) =&gt; [params.page, params.count],</p>
<p>  // unless we will invoke with second parameter object with asyncForce: true,
  // it won&apos;t be requested again
  // dispatch(actions.tiles.api.photos(params, { asyncForce: true }))
  caching: true,
});</p>
<pre><code>
We also sometimes want to keep some sync info (e.g. list of notifications), or we want to store some numbers for calculator, or active filters ([todoMVC](http://todomvc.com/) is a good example of a lot of synchronous operations). In this situation we will use `createSyncTile`, which has no meta data like `isPending`, `error` or `fetched`, but keeps all returned data from a function directly in state.

&gt; [Full documentation for sync tiles](https://redux-tiles.js.org/api/createSyncTile.html)

```javascript
import { createSyncTile } from &apos;redux-tiles&apos;;

const notifications = createSyncTile({
  type: [&apos;notifications&apos;],


  // all parameters are the same as in async tile
  fn: ({ params, dispatch, actions }) =&gt; {
    // we can dispatch async actions &#x2013; but we can&apos;t wait
    // for it inside sync tiles
    dispatch(actions.tiles.user.dismissTerms());

    return {
      type: params.type,
      data: processData(params.data),
    };
  },

  // alternatively, if you perform some actions on existing data,
  // it might be useful to write more declarative actions
  // they have exactly the same signature and dispatch returned data
  // to the tile
  fns: {
    add: ({ params, selectors, getState}) =&gt; {
      const currentData = selectors.notifications(getState(), params);

      return {
        ...currentData,
        data: currentData.concat(params.data),
      };
    },
  },

  // you can pass initial state to sync tile
  // please, be careful with it! if you use nesting, then
  // you have to specify nested items (otherwise selectors will
  // return undefined for your nested item)
  initialState: {
    terms: {
      type: &apos;terms&apos;,
      data: []
    },
  },

  // nesting works the same way
  nesting: ({ type }) =&gt; [type],
});
</code></pre><h2 id="nesting">Nesting</h2>
<blockquote>
<p><a href="https://redux-tiles.js.org/advanced/nesting.html" target="_blank">Full documentation on nesting</a></p>
</blockquote>
<p>Very often we have to separate some info, and with canonical redux we have to write something like this:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">case</span> ACTION.SOME_CONSTANT:
  <span class="hljs-keyword">return</span> {
    ...state,
    [action.payload.id]: {
      [action.payload.quantity]: {
        ...state[action.payload.id],
        ...action.payload.data,
      },
    },
  };
</code></pre>
<p>Or with <code>Object.assign</code>, which will make it even less readable. This is a pretty common pattern, and also pretty error prone &#x2013; so we have to cover such code with unit-tests, while in reality they don&apos;t do a lot of intrinsic logic &#x2013; just merge. Of course, we can use something like <code>lodash.merge</code>, but it is not always suitable. In tiles we have <code>nesting</code> property, in which you can specify a function from which you can return an array of nested values. The same code as above:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> infoTile = createTile({
  type: [<span class="hljs-string">&apos;info&apos;</span>, <span class="hljs-string">&apos;storage&apos;</span>],

  <span class="hljs-comment">// params here and in nesting are the same object</span>
  fn: ({ params: { quantity, id }, api }) =&gt; api.get(<span class="hljs-string">&apos;/storage&apos;</span>, { quantity, id }),

  <span class="hljs-comment">// in the state they will be kept with the following structure:</span>
  <span class="hljs-comment">// {</span>
  <span class="hljs-comment">//   someId: {</span>
  <span class="hljs-comment">//     5: {</span>
  <span class="hljs-comment">//       isPending: true,</span>
  <span class="hljs-comment">//       fetched: false,</span>
  <span class="hljs-comment">//       data: null,</span>
  <span class="hljs-comment">//       error: null,</span>
  <span class="hljs-comment">//     },</span>
  <span class="hljs-comment">//   },</span>
  <span class="hljs-comment">// }</span>
  nesting: ({ quantity, id }) =&gt; [id, quantity],
});
</code></pre>
<h2 id="middleware">Middleware</h2>
<p>In order to use this library, you have to apply middleware, which will handle functions returned from dispatched actions. Very basic one is provided by this package:</p>
<blockquote>
<p><a href="https://redux-tiles.js.org/api/createMiddleware.html" target="_blank">Full documentation for middleware</a>
```javascript
import { createMiddleware } from &apos;redux-tiles&apos;;</p>
</blockquote>
<p>// these are not required, but adding them allows you
// to do Dependency Injection pattern, so it is easier to test
import actions from &apos;../actions&apos;;
import selectors from &apos;../selectors&apos;;</p>
<p>// it is a good idea to put API layer inside middleware, so
// you can easily separate client and server, for instance
import api from &apos;../utils/api&apos;;</p>
<p>// this object is optional. every property will be available inside
// <code>fn</code> of all tiles
// also, <code>waitTiles</code> is helpful for server-side-rendering
const { middleware, waitTiles } = createMiddleware({ actions, selectors, api });
applyMiddleware(middleware);</p>
<pre><code>
Also, [redux-thunk](https://github.com/gaearon/redux-thunk) is supported, and in order to pass your own properties you should [inject this object to redux-thunk](https://github.com/gaearon/redux-thunk#injecting-a-custom-argument). Also, there is nothing bad to just import actions and selectors on top of the files, but then testing might require much more mocking, which can make your tests more brittle.

## Server-side Rendering

&gt; [Article about SSR with prefetch](http://blog.bloomca.me/2017/06/11/server-side-rendering-with-prefetch.html)

Redux-tiles support requests on the server side. In order to do that correctly, you are supposed to create actions for each request in Node.js. Redux-Tiles has caching for async requests (and keeps them inside middleware, so they are not shared between different user requests) &#x2013; it keeps list of all active promises, so you might accidentaly share this part of the memory with other users!

Also, to make this part of functionality working, you have to use redux-tiles middleware, or pass `promisesStorage` object to redux-thunk additional object (more in [caching section in docs](https://redux-tiles.js.org/api/createTile.html#caching)).

```javascript
import { createMiddleware, createEntities } from &apos;redux-tiles&apos;;
import { createStore, applyMiddleware } from &apos;redux&apos;;
import tiles from &apos;../../common/tiles&apos;;

const { actions, reducer, selectors } = createEntities(tiles);
const { middleware, waitTiles } = createMiddleware({ actions, selectors });
const store = createStore(reducer, {}, applyMiddleware(middleware));

// this is a futile render. It is needed only to kickstart requests
// unfortunately, there is no way to avoid it
renderApplication(req);

// wait for all requests which were fired during the render
await waitTiles();

// this time you can safely render your application &#x2013; all requests
// which were in `componentWillMount` will be fullfilled
// remember, `componentDidMount` is not fired on the server
res.send(renderApplication(req));
</code></pre><p>There is also a package <a href="https://github.com/Bloomca/delounce" target="_blank">delounce</a>, from where you can get <code>limit</code> function, which will render the application if requests are taking too long.</p>
<h2 id="selectors">Selectors</h2>
<blockquote>
<p><a href="https://redux-tiles.js.org/advanced/selectors.html" target="_blank">Full documentation on selectors</a></p>
</blockquote>
<p>All tiles provide selectors. After you&apos;ve collected all tiles, invoke <code>createSelectors</code> function with possible change of default namespace, and after you can just use it based on the passed type:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { createTile, createSelectors } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;redux-tiles&apos;</span>;

<span class="hljs-keyword">const</span> tile = createTile({
  type: [<span class="hljs-string">&apos;user&apos;</span>, <span class="hljs-string">&apos;auth&apos;</span>],
  fn: ...,
  nesting: ({ id }) =&gt; [id],
});

<span class="hljs-keyword">const</span> tiles = [tile];

<span class="hljs-keyword">const</span> selectors = createSelectors(tiles);

<span class="hljs-comment">// second argument is params with which you dispatch action &#x2013; it will get data</span>
<span class="hljs-comment">// for corresponding nesting</span>
<span class="hljs-keyword">const</span> { isPending, fetched, data, error } = selectors.user.auth(state, { id: <span class="hljs-string">&apos;456&apos;</span> });
</code></pre>
<h2 id="tests">Tests</h2>
<p>Almost all business logic will be contained in &quot;complex&quot; tiles, which don&apos;t do requests by themselves, rather dispatching other tiles, composing results from them. It is very important to pass all needed functions via middleware, so you can easily mock it without relying on other modules. All passed data is available in tiles via <code>reflect</code> property.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { createTile } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;redux-tiles&apos;</span>;

<span class="hljs-keyword">const</span> params = {
  type: [<span class="hljs-string">&apos;auth&apos;</span>, <span class="hljs-string">&apos;token&apos;</span>],
  fn: ({ api, params }) =&gt; api.post(<span class="hljs-string">&apos;/token&apos;</span>, params),
};
<span class="hljs-keyword">const</span> tile = createTile(params);

<span class="hljs-comment">// same object</span>
assert(tile.reflect === params); <span class="hljs-comment">// true</span>
</code></pre>
<h2 id="contributing">Contributing</h2>
<p>All suggestions or participating are welcome! If you have any idea about improving API, or bringing some common functionality, don&apos;t hesitate, but please create an issue.
Also, in case you really think something is missing or wrong, please create an issue first, where we will discuss the problem and possible solutions, and then we can agree on implementation details.</p>
<h2 id="license">LICENSE</h2>
<p>MIT</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Introduction">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="introduction/README.md" class="navigation navigation-next " aria-label="Next page: 介绍">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"读我，了解我是干啥的～","level":"1.2","depth":1,"next":{"title":"介绍","level":"1.3","depth":1,"path":"introduction/README.md","ref":"./introduction/README.md","articles":[{"title":"动机","level":"1.3.1","depth":2,"path":"introduction/Motivation.md","ref":"./introduction/Motivation.md","articles":[]},{"title":"Redux样板代码概述","level":"1.3.2","depth":2,"path":"introduction/Boilerplate.md","ref":"./introduction/Boilerplate.md","articles":[]},{"title":"与其他解决方案比较","level":"1.3.3","depth":2,"path":"introduction/Comparison.md","ref":"./introduction/Comparison.md","articles":[]},{"title":"实例","level":"1.3.4","depth":2,"path":"introduction/Example.md","ref":"./introduction/Example.md","articles":[]}]},"previous":{"title":"Introduction","level":"1.1","depth":1,"path":"README.md","ref":"README.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["github-buttons","livereload"],"pluginsConfig":{"github-buttons":{"repo":"Kirk-Wang/cn-redux-tiles","types":["star","fork","watch"],"size":"large"},"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"original_readme.md","mtime":"2017-11-15T11:43:08.930Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-11-15T11:38:08.796Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-github-buttons/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

